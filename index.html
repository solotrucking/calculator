<div class="bootstrapiso" id="calculator">
  <script>var fuelPrice = 3.241</script>
  <div class="openCalculator">
    <button class="btn btn-lg btn-primary" onclick="setCalculatorVisibility(true)">Calculate Your Earnings</button>
    <p>*Your results will vary.</p>
  </div>
  <br />
  <div class="calculator">
    <form class="form-signin antijump-wrapper" id="soloCalcForm">
      <label class="my-1 mr-2">Equipment Type</label>
      <div class="form-group btn-block btn-group btn-group-toggle" data-toggle="buttons">
        <label class="btn btn-secondary active">
          <input type="radio" name="equipmentType" checked value="van" autocomplete="off">Dry Van
        </label>
        <label class="btn btn-secondary">
          <input type="radio" name="equipmentType" value="flatbed" autocomplete="off">Flatbed
        </label>
        <label class="btn btn-secondary">
          <input type="radio" name="equipmentType" value="other" autocomplete="off">Other
        </label>
      </div>
      <label class="my-1 mr-2">How You Run</label>
      <div class="form-group btn-block btn-group btn-group-toggle" data-toggle="buttons">
        <label class="btn btn-secondary active">
          <input type="radio" name="runType" checked value="local" autocomplete="off">Local
        </label>
        <label class="btn btn-secondary">
          <input type="radio" name="runType" value="regional" autocomplete="off">Regional
        </label>
        <label class="btn btn-secondary">
          <input type="radio" name="runType" value="longHaul" autocomplete="off">Long Haul
        </label>
      </div>
      <label class="my-1 mr-2">Experience Negotiating Rates</label>
      <div class="form-group btn-block btn-group btn-group-toggle" data-toggle="buttons">
        <label class="btn btn-secondary active">
          <input type="radio" name="negotiatingSkill" checked value="novice" autocomplete="off">Novice
        </label>
        <label class="btn btn-secondary">
          <input type="radio" name="negotiatingSkill" value="experienced" autocomplete="off">Experienced
        </label>
        <label class="btn btn-secondary">
          <input type="radio" name="negotiatingSkill" value="pro" autocomplete="off">Pro Negotiator
        </label>
      </div>
      <!-- <div class="form-group">
        <label for="weeklyMiles">Weekly Average: 500 miles</label>
        <input type="range" class="form-control-range" name="weeklyMiles" value="500" min="500" max="3500" step="10" id="weeklyMiles">
        <label for="weeklyMiles">500</label>
        <label class="float-right" for="weeklyMiles">3500</label>
      </div> -->
      <div class="form-row">
        <div class="form-label-group col">
          <input required type="number" pattern="[0-9]*" inputmode="numeric" id="weeklyMiles" name="weeklyMiles" class="form-control" placeholder="Weekly Avg Miles">
          <label for="weeklyMiles">Weekly Avg Miles</label>
          <div class="invalid-feedback">How many miles do you run a week?</div>
        </div>
        <div class="form-label-group col">
          <input required type="number" pattern="[0-9]*" inputmode="numeric" step="0.01" id="truckMpg" name="truckMpg" class="form-control" placeholder="Truck MPG">
          <label for="truckMpg">Truck MPG</label>
          <div class="invalid-feedback">How many MPG does your truck get?</div>
        </div>
      </div>
      <!-- <div class="form-group">
        <label for="truckMpg">Truck MPG: 8.00</label>
        <input type="range" class="form-control-range" name="truckMpg" value="8" min="5" max="12" step="0.01" id="truckMpg">
        <label for="truckMpg">5.00</label>
        <label class="float-right" for="truckMpg">12.00</label>
      </div> -->
      <div class="form-group btn-group btn-group-toggle" data-toggle="buttons">
        <label class="btn btn-secondary">
          <input type="radio" name="isRentingTrailer" value="true" autocomplete="off">Yes
        </label>
        <label class="btn btn-secondary active">
          <input type="radio" checked name="isRentingTrailer" value="false" autocomplete="off">No
        </label>
      </div>
      <label for="isRentingTrailer">I need to rent a trailer.</label>
      <br />
      <div class="form-group btn-group btn-group-toggle" data-toggle="buttons">
        <label class="btn btn-secondary">
          <input type="radio" name="isRentingPlates" value="true" autocomplete="off">Yes
        </label>
        <label class="btn btn-secondary active">
          <input type="radio" checked name="isRentingPlates" value="false" autocomplete="off">No
        </label>
      </div>
      <label for="isRentingPlates">I need plates.</label>
      <br />
      <div class="form-group btn-group btn-group-toggle" data-toggle="buttons">
        <label class="btn btn-secondary">
          <input type="radio" name="isNeedingBobtailInsurance" value="true" autocomplete="off">Yes
        </label>
        <label class="btn btn-secondary active">
          <input type="radio" checked name="isNeedingBobtailInsurance" value="false" autocomplete="off">No
        </label>
      </div>
      <label for="isNeedingBobtailInsurance">I need Bobtail Insurance.</label>
      <div class="form-group antijump-wrapper" id="equipmentValueGroup">
        <div class="form-label-group">
          <input type="number" pattern="[0-9]*" inputmode="numeric" id="equipmentValue" name="equipmentValue" class="form-control" placeholder="$ Value of Truck">
          <label for="equipmentValue">$ Value of Truck</label>
          <div class="invalid-feedback">How much your equipment is worth? A rough dollar estimate is fine.</div>
        </div>
        <!-- <label for="equipmentValue">Value of Truck: $500</label>
        <input type="range" class="form-control-range" name="equipmentValue" value="500" min="500" max="250000" step="500" id="equipmentValue">
        <label for="equipmentValue">$500</label>
        <label class="float-right" for="equipmentValue">$250,000</label> -->
      </div>
      <div class="form-row">
        <div class="form-label-group col">
          <input required type="email" id="email" name="email" class="form-control" placeholder="Email Address">
          <label for="email">Email</label>
          <div class="invalid-feedback">Enter your email so we can discuss your results.</div>
          <!-- <small id="emailHelp" class="form-text text-muted">We'll never share your email.</small> -->
        </div>
        <div class="form-label-group col">
          <input required type="text" id="firstName" name="firstName" class="form-control" placeholder="First Name">
          <label for="firstName">First Name</label>
          <div class="invalid-feedback">What should we call you?</div>
          <!-- <small id="firstNameHelp" class="form-text text-muted">So we know what to call you!</small> -->
        </div>
      </div>
      <button class="btn btn-lg btn-primary btn-block" name="calculate" id="calculate" type="submit" data-toggle="modal" data-target="#resultModal">Calculate</button>
      <p>*Your results will vary.</p>
      <div class="modal fade" id="resultModal" tabindex="-1" role="dialog" aria-labelledby="resultModalTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title mx-auto" id="resultModalTitle">Net Weekly Pay After Deductions</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <h1 class="modal-body mx-auto" id="result"></h1>
            <div class="modal-footer btn-group">
              <button type="button" class="btn btn-secondary" onclick="setCalculatorVisibility(false)" data-dismiss="modal">Keep Reading</button>
              <button type="button" class="btn btn-primary" onclick="Calendly.showPopupWidget('https://calendly.com/armando-solotrucking/learn-about-solo', 'PopupWidget')">Give Us A Call</button>
              <button type="button" class="btn btn-success" onclick="window.open('https://intelliapp.driverapponline.com/c/SOLOTRUCKING?uri_b=ia_solotrucking_247090839')">Apply Now</button>
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>

<style>
  .bootstrapiso { /* also isolates boostrap styles*/
    height: 100%;
    padding-top: 40px;
    padding-bottom: 40px;
    background-color: #f5f5f5;
    --input-padding-x: .75rem;
    --input-padding-y: .75rem;
  }
  .bootstrapiso .openCalculator {
    text-align: center;
  }
  .bootstrapiso .calculator {
    display: -ms-flexbox;
    display: -webkit-box;
    display: flex;
    -ms-flex-align: center;
    -ms-flex-pack: center;
    -webkit-box-align: center;
    align-items: center;
    -webkit-box-pack: center;
    justify-content: center;
    width: 100%;
    max-width: 420px;
    /* padding: 15px; */
    margin: 0 auto;
  }
  .bootstrapiso .antijump-wrapper {
    height: 0;
    overflow: hidden;
    transition: height 0.5s ease-out;
  }
  .bootstrapiso .antijump-wrapper.showcalc {
    height: 850px;
  }
  .bootstrapiso .antijump-wrapper.show {
    height: 70px;
  }
  .bootstrapiso .btn-secondary.active {
    background-color: #484848 !important;
  }
  .bootstrapiso .form-label-group {
    position: relative;
    margin-bottom: 1rem;
  }
  .bootstrapiso .form-label-group > input,.form-label-group > label {
    padding: var(--input-padding-y) var(--input-padding-x);
  }
  .bootstrapiso .form-label-group > label {
    position: absolute;
    top: 0;
    left: 0;
    display: block;
    width: 100%;
    margin-bottom: 0; /* Override default `<label>` margin */
    line-height: 1.5;
    color: #495057;
    border: 1px solid transparent;
    border-radius: .25rem;
    transition: all .1s ease-in-out;
  }
  .bootstrapiso .form-label-group input::-webkit-input-placeholder {
    color: transparent;
  }
  .bootstrapiso .form-label-group input:-ms-input-placeholder {
    color: transparent;
  }
  .bootstrapiso .form-label-group input::-ms-input-placeholder {
    color: transparent;
  }
  .bootstrapiso .form-label-group input::-moz-placeholder {
    color: transparent;
  }
  .bootstrapiso .form-label-group input::placeholder {
    color: transparent;
  }
  .bootstrapiso .form-label-group input:not(:placeholder-shown) {
    padding-top: calc(var(--input-padding-y) + var(--input-padding-y) * (2 / 3));
    padding-bottom: calc(var(--input-padding-y) / 3);
  }
  .bootstrapiso .form-label-group input:not(:placeholder-shown) ~ label {
    padding-top: calc(var(--input-padding-y) / 3);
    padding-bottom: calc(var(--input-padding-y) / 3);
    font-size: 12px;
    color: #777;
  }
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/cryptoapi/Isolate-Bootstrap-4.1-CSS-Themes/css4.1/bootstrapcustom.min.css" crossorigin="anonymous">

<script>
  var form = document.getElementById("soloCalcForm")
  function setCalculatorVisibility (isVisible) {
    if (isVisible) {
      form.classList.add("showcalc")
      document.querySelector(".openCalculator").style.display = "none"
    } else {
      form.classList.remove("showcalc")
      document.querySelector(".openCalculator").style.display = ""
    }
  }

  changeEquipmentForEquipmentValue() // to hide equipmentValue initially
  form.onsubmit = function (e) {
    e.preventDefault() // prevent form from redirecting page on submit
  }
  // form.weeklyMiles.oninput = function () {
  //   form.weeklyMiles.labels[0].innerText = "Weekly Average: " + form.weeklyMiles.value + ' miles'
  // }
  // form.truckMpg.oninput = function () {
  //   form.truckMpg.labels[0].innerText = "Truck MPG: " + form.truckMpg.value
  // }
  form.equipmentValue.oninput = changeEquipmentForEquipmentValue
  var isRentingTrailerRadios = [...form.isRentingTrailer] // must be separate variable declaration for nodeList spread
  isRentingTrailerRadios.forEach(radioButton => radioButton.onchange = changeEquipmentForEquipmentValue)
  var isNeedingBobtailInsuranceRadios = [...form.isNeedingBobtailInsurance] // must be separate variable declaration for nodeList spread
  isNeedingBobtailInsuranceRadios.forEach(radioButton => radioButton.onchange = changeEquipmentForEquipmentValue)
  form.calculate.onclick = function (event) {
    var equipmentType = String(form.equipmentType.value)
    var runType = String(form.runType.value)
    var negotiatingSkill = String(form.negotiatingSkill.value)
    var weeklyMiles = Number(form.weeklyMiles.value)
    var truckMpg = Number(form.truckMpg.value)
    var bobtail = Boolean(form.isNeedingBobtailInsurance.value  === "true")
    var equipmentValue = Number(form.equipmentValue.value)
    var email = String(form.email.value)
    var firstName =  String(form.firstName.value)
    var params = {equipmentType, runType, negotiatingSkill, weeklyMiles, truckMpg, bobtail, equipmentValue, email, firstName}

    try {
      validate(params, event) // may display error then throw
    } catch (errors) {
      slack({text: "ERRORS: ```" + errors + "```\n" + "PARAMS: ```" + JSON.stringify(params) + "```"})
      throw errors
    }
    // setCalculatorVisibility(false)

    var deadheadPct = {local: 0.15, regional: 0.125, longHaul: 0.10}[runType]
    var runTypeAdjustmentPct = ({local: 1.10, regional: 1.00, longHaul: 0.95})[runType]
    var negotiationAdjustmentPct = ({novice: 0.90, experienced: 1.00, pro: 1.10})[negotiatingSkill]
    var ratePerMile = 2.5 * runTypeAdjustmentPct * negotiationAdjustmentPct
    var loadedMiles = weeklyMiles * (1 - deadheadPct)
    var gross = loadedMiles * ratePerMile
    var toTruck = gross * 0.75
    var fuel = weeklyMiles / truckMpg * fuelPrice
    var occAcc = 35
    var eld = 7
    var escrow = 100
    var trailer = Boolean(form.isRentingTrailer.value === "true") ? 250 : 0
    var plates = Boolean(form.isRentingPlates.value  === "true") ? 100 : 0
    var insurance = equipmentValue * (bobtail ? 0.06 / 52 : 0)
    var netPay = toTruck - fuel - occAcc - eld - escrow - trailer - plates - insurance

    document.getElementById("result").innerText = money(netPay)
    slack({text: "PARAMS: ```" + JSON.stringify({email,firstName,netPay,runType,weeklyMiles,deadheadPct,negotiatingSkill,ratePerMile,loadedMiles,gross,toTruck,fuelPrice,fuel,occAcc,eld,escrow,truckMpg,trailer,plates,equipmentValue,insurance,equipmentType}) + "```"})
  }
  function changeEquipmentForEquipmentValue () {
    if (form.isNeedingBobtailInsurance.value === "true") {
      document.getElementById("equipmentValueGroup").classList.add("show")
      form.equipmentValue.required = true
    } else {
      document.getElementById("equipmentValueGroup").classList.remove("show")
      form.equipmentValue.required = false
    }
    var equipmentString = Boolean(form.isRentingTrailer.value === "true") ? "Truck & Trailer" : "Truck"
    form.equipmentValue.labels[0].innerText = `$ Value of ${equipmentString}`
    form.equipmentValue.placeholder = `$ Value of ${equipmentString}`
    // form.equipmentValue.labels[0].innerText = `Value of ${equipmentString}: ` + money(form.equipmentValue.value)
  }
  function money (number) {
    return '$' + (Math.round(number * 100) / 100).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
  }

  function slack(data, callback) {
    if (window.location.href.includes("https://solotrucking.github.io/calculator")) return console.log("admin Slack! " + JSON.stringify(data))
    if (window.location.href.includes("file:///")) return console.log("dev Slack! " + JSON.stringify(data))
    callback = callback || function () { /* no-op */ }
    var request = new XMLHttpRequest()
    request.onreadystatechange = () => request.readyState == 4 && String(request.status)[0] == 2 && callback(request.responseText)
    request.open("POST", "https://hooks.slack.com/services/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", true) // true for asynchronous
    request.send(JSON.stringify(data))
  }

  function validate (params, event) {
    if (window.location.href.includes("https://solotrucking.github.io/calculator")) return console.warn("admin skipping validation")
    // if (window.location.href.includes("file:///")) return console.warn("dev skipping validation")
    form.classList.add("was-validated")
    const errors = []
    if (!params.weeklyMiles || isNaN(params.weeklyMiles)) {
      event.stopPropagation()
      errors.push("weeklyMiles: " + params.weeklyMiles)
    }
    if (!params.truckMpg || isNaN(params.truckMpg)) {
      event.stopPropagation()
      errors.push("truckMpg: " + params.truckMpg)
    }
    if (params.bobtail && (!params.equipmentValue || isNaN(params.equipmentValue))) {
      event.stopPropagation()
      errors.push("equipmentValue: " + params.bobtail + params.equipmentValue)
    }
    if (!params.firstName) {
      event.stopPropagation()
      errors.push("firstName: " + params.firstName)
    }
    if (!params.email) {
      event.stopPropagation()
      errors.push("email: " + params.email)
    }
    if (errors.length) throw new Error("validation errors " + errors.join("\n"))
  }
</script>

<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>
